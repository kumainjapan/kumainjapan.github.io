


<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- <link rel="icon" href="../../favicon.ico"> -->

    <title>Kuma in Japan</title>

    <!-- Bootstrap core CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

    <!-- Custom styles for this template -->
    <link href="blog.css" rel="stylesheet">
	
	<link rel="stylesheet" href="https://mapzen.com/js/mapzen.css">
	<script src="https://mapzen.com/js/mapzen.min.js"></script>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="https://d3js.org/topojson.v2.min.js"></script>
	
	<style>
		#map { 
			height: 450px; 
			width: 100%;
			padding-bottom: 1.25rem;
			margin-bottom: 2rem;
		}
		#prefecture-detail {

		}
	</style>
  </head>

  <body>

    <div class="blog-masthead">
      <div class="container clearfix">
		<!-- 
        <nav>
          <ul class="nav float-right">
            <li class="nav-item">
              <a class="nav-link active" href="#">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">New features</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Press</a>
            </li>
          </ul>
        </nav>
		-->
		<div class="home-logo float-left"> 
			<a href="#"><img src="logo.png"/></a>
		</div>
      </div>
    </div>

    <div class="container">

		<div class="row">
		
		<div class="col-sm-3 blog-sidebar">
          <div class="sidebar-module sidebar-module-inset" style="height: 450px;">
            <h4 id="prefecture"></h4>
            <p id="prefecture-detail"></p>
          </div>
        </div>
		
        <div class="col-sm-9 blog-main">
			<div id="map"></div>
        </div><!-- /.blog-main -->
      </div><!-- /.row -->
	  
	
      <div class="row">
		<div class="col-sm-3 blog-sidebar">
          <div class="sidebar-module sidebar-module-inset">
            <h4>About</h4>
            <p>Etiam porta <em>sem malesuada magna</em> mollis euismod. Cras mattis consectetur purus sit amet fermentum. Aenean lacinia bibendum nulla sed consectetur.</p>
          </div>
          <div class="sidebar-module">
            <h4>Archives</h4>
            <ol class="list-unstyled">
              <li><a href="#">March 2014</a></li>
              <li><a href="#">February 2014</a></li>
              <li><a href="#">January 2014</a></li>
            </ol>
          </div>
        </div><!-- /.blog-sidebar -->
		
		
        <div class="col-sm-9 blog-main">

          <div class="blog-post">
            <h2 class="blog-post-title">New feature</h2>
            <p class="blog-post-meta">December 14, 2013 by <a href="#">Chris</a></p>

            <p>Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Aenean lacinia bibendum nulla sed consectetur. Etiam porta sem malesuada magna mollis euismod. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus.</p>
            <ul>
              <li>Praesent commodo cursus magna, vel scelerisque nisl consectetur et.</li>
              <li>Donec id elit non mi porta gravida at eget metus.</li>
              <li>Nulla vitae elit libero, a pharetra augue.</li>
            </ul>
            <p>Etiam porta <em>sem malesuada magna</em> mollis euismod. Cras mattis consectetur purus sit amet fermentum. Aenean lacinia bibendum nulla sed consectetur.</p>
            <p>Donec ullamcorper nulla non metus auctor fringilla. Nulla vitae elit libero, a pharetra augue.</p>
          </div><!-- /.blog-post -->

          <nav class="blog-pagination">
            <a class="btn btn-outline-primary" href="#">Older</a>
            <a class="btn btn-outline-secondary disabled" href="#">Newer</a>
          </nav>

        </div><!-- /.blog-main -->

        

      </div><!-- /.row -->

    </div><!-- /.container -->

    <footer class="blog-footer">
      <p>Blog template built for <a href="https://getbootstrap.com">Bootstrap</a> by <a href="https://twitter.com/mdo">@mdo</a>.</p>
      <p>
        <a href="#">Back to top</a>
      </p>
    </footer>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>

	<script>
		
		L.TopoJSON = L.GeoJSON.extend({  
			addData: function(jsonData) {    
				if (jsonData.type === "Topology") {
					for (key in jsonData.objects) {
						geojson = topojson.feature(jsonData, jsonData.objects[key]);
						L.GeoJSON.prototype.addData.call(this, geojson);
					}
				}    
				else {
					L.GeoJSON.prototype.addData.call(this, jsonData);
				}
			}  
		});
		

		L.Mapzen.apiKey = 'mapzen-V35T5SC';
		var map = L.Mapzen.map('map', {
			tangramOptions: {
				scene: L.Mapzen.BasemapStyles.Refill //BubbleWrap
			},
			maxBounds: [
				//south west
				[28.48, 103.08],
				//north east
				[46.79, 170.04]
			], 
			minZoom: 6,
			maxZoom: 6,
			zoomControl:false,
			attribution: ''
		})
		map.setView([36.2813, 137.41455], 6);
		map.scrollWheelZoom.disable();
		
		var clicked_layer = [];

		d3.queue()
		//.defer(d3.json, 'japan.geojson')
		.defer(d3.json, 'japan.topojson')
		.defer(d3.csv, 'japan.csv')
		.await(ready);
		
		function ready(error, topojson, csv_data) {
			if (error) throw error;
			init_map(topojson, csv_data);
		}
		
		var layer_config = {
			style: {
				'color': '#000',
				'weight': 1
				//'opacity': 0.5
				//'fillOpacity': 0.5
			},
			onEachFeature: function (feature, layer) {
				layer.on({
					mouseover: function (e) {
						var layer = e.target;
						layer.setStyle({
							'fillOpacity': 0.8
						});
						if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
							layer.bringToFront();
						}
						//layer.bindTooltip(feature.properties.nam).openTooltip();
						$('#prefecture').text(feature.properties.nam);
						$('#prefecture-detail').text(csv[feature.properties.id].desc);
					},
					mouseout: function (e) {
						if (!clicked_layer.includes(e.target))
							topoLayer.resetStyle(e.target);
					},
					click: function (e) {
						if (!clicked_layer.includes(e.target)) {
							clicked_layer.push(e.target);
							e.target.setStyle({ fillOpacity: 1 });
						} else {
							clicked_layer.splice( clicked_layer.indexOf(e.target), 1 );
						}
					}
				})
			}
		}
		
		var csv;
		var topoLayer; 
		function init_map(topojson, csv_data) {
			topoLayer = new L.TopoJSON(null, layer_config);
			topoLayer.addData(topojson);
			topoLayer.addTo(map);

			csv = csv_data.reduce(function(arr, item) {
				arr[item.id] = item; 
				return arr;
			}, {});
								
			//var geojson = L.geoJson(json, layer_config);
			//.addTo(map);
		}
		
	</script>
  </body>
</html>



